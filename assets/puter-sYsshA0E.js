import{R as o}from"./chunk-EPOLDU6W-CHk03_CN.js";const d=e=>{let n;const t=new Set,s=(i,l)=>{const u=typeof i=="function"?i(n):i;if(!Object.is(u,n)){const h=n;n=l??(typeof u!="object"||u===null)?u:Object.assign({},n,u),t.forEach(S=>S(n,h))}},r=()=>n,c={setState:s,getState:r,getInitialState:()=>g,subscribe:i=>(t.add(i),()=>t.delete(i))},g=n=e(s,r,c);return c},b=(e=>e?d(e):d),w=e=>e;function p(e,n=w){const t=o.useSyncExternalStore(e.subscribe,o.useCallback(()=>n(e.getState()),[e,n]),o.useCallback(()=>n(e.getInitialState()),[e,n]));return o.useDebugValue(t),t}const f=e=>{const n=b(e),t=s=>p(n,s);return Object.assign(t,n),t},y=(e=>e?f(e):f),a=()=>typeof window<"u"&&window.puter?window.puter:null,L=y((e,n)=>({isLoading:!0,error:null,puterReady:!1,auth:{isAuthenticated:!1,user:null,signIn:async()=>{const t=a();t&&(e({isLoading:!0}),await t.auth.signIn(),await n().init())},signOut:async()=>{const t=a();t&&(e({isLoading:!0}),await t.auth.signOut(),e({auth:{...n().auth,isAuthenticated:!1,user:null},isLoading:!1}))}},init:async()=>{const t=a();if(!t){e({error:"Puter.js not available",isLoading:!1});return}try{if(await t.auth.isSignedIn()){const r=await t.auth.getUser();e({auth:{...n().auth,isAuthenticated:!0,user:r},puterReady:!0,isLoading:!1})}else e({auth:{...n().auth,isAuthenticated:!1,user:null},puterReady:!0,isLoading:!1})}catch(s){e({error:s?.message||"Auth init failed",isLoading:!1})}},fs:{upload:t=>a().fs.upload(t),write:(t,s)=>a().fs.write(t,s),read:t=>a().fs.read(t),delete:t=>a().fs.delete(t),readDir:t=>a().fs.readdir(t)},ai:{chat:(...t)=>a().ai.chat(...t),img2txt:(t,s)=>a().ai.img2txt(t,s)},kv:{get:t=>a().kv.get(t),set:(t,s)=>a().kv.set(t,s),delete:t=>a().kv.delete(t),list:(t,s)=>a().kv.list(t,s),flush:()=>a().kv.flush()},clearError:()=>e({error:null})}));export{L as u};
